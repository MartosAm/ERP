import{a as Le}from"./chunk-UHEGE2CD.js";import{A as je,B as Be,a as he,b as ge,c as xe,d as be,e as Ee,f as ve,g as Me,h as Se,i as De,j as ye,k as Te,n as we,o as Ie,p as Fe,q as Ne,r as Pe,s as Ve,t as Re,u as ke,v as Ae,w as A,x as $e,y as ze,z as He}from"./chunk-DYVYMDZ3.js";import{a as ne,b as oe,c as ae,d as re,h as le,i as me,j as ce,k as se}from"./chunk-WGOZBQ6C.js";import{a as ue,b as fe,c as Ce,d as _e}from"./chunk-OPDHGN22.js";import{b as X,d as b,f as U,g as J,j as K,k as Q,m as W,n as Y,p as Z,q as ee,r as te,s as ie}from"./chunk-25KKNSP5.js";import{a as V,b as R}from"./chunk-GZNJA4L5.js";import{a as I,c as pe,d as P}from"./chunk-TIT22AFP.js";import{$ as N,Z as F,_ as de,i as O,xa as k}from"./chunk-BAV5PXE6.js";import{p as w}from"./chunk-C42ID75Y.js";import{$a as m,Db as n,Eb as i,Fa as j,Fb as c,Gb as h,Hb as g,Jb as y,Ob as f,Qb as x,Xb as B,Yb as a,Zb as E,_b as S,bc as T,ca as H,cc as L,fc as q,gc as G,ia as d,mb as C,na as D,sb as s,ub as p,xa as v,ya as M,zb as _}from"./chunk-HI7W2E7R.js";var $=(()=>{class t{constructor(){this.api=d(O)}listar(e){return this.api.getPaginado("clientes",e)}obtenerPorId(e){return this.api.get(`clientes/${e}`)}crear(e){return this.api.post("clientes",e)}actualizar(e,o){return this.api.patch(`clientes/${e}`,o)}eliminar(e){return this.api.delete(`clientes/${e}`)}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275prov=H({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Ue(t,r){t&1&&(n(0,"mat-error"),a(1,"El nombre es obligatorio"),i())}function Je(t,r){t&1&&(n(0,"mat-error"),a(1,"M\xEDnimo 2 caracteres"),i())}function Ke(t,r){t&1&&(n(0,"mat-error"),a(1,"Correo inv\xE1lido"),i())}function Qe(t,r){t&1&&(n(0,"mat-error"),a(1,"M\xE1ximo 13 caracteres"),i())}function We(t,r){t&1&&c(0,"mat-spinner",18)}var z=(()=>{class t{get esEdicion(){return this.data.modo==="editar"}constructor(){if(this.fb=d(te),this.svc=d($),this.notify=d(k),this.dialogRef=d(Fe),this.data=d(Ne),this.guardando=C(!1),this.form=this.fb.nonNullable.group({nombre:["",[b.required,b.minLength(2),b.maxLength(150)]],telefono:[""],correo:["",[b.email]],direccion:[""],rfc:["",[b.maxLength(13)]],notas:[""],limiteCredito:[0,[b.min(0)]],diasCredito:[0,[b.min(0)]]}),this.esEdicion&&this.data.cliente){let e=this.data.cliente;this.form.patchValue({nombre:e.nombre,telefono:e.telefono??"",correo:e.correo??"",direccion:e.direccion??"",rfc:e.rfc??"",limiteCredito:e.limiteCredito,diasCredito:e.diasCredito})}}guardar(){if(this.form.invalid){this.form.markAllAsTouched();return}this.guardando.set(!0);let e=this.form.getRawValue(),o={nombre:e.nombre};e.telefono&&(o.telefono=e.telefono),e.correo&&(o.correo=e.correo),e.direccion&&(o.direccion=e.direccion),e.rfc&&(o.rfc=e.rfc),e.notas&&(o.notas=e.notas),e.limiteCredito>0&&(o.limiteCredito=e.limiteCredito),e.diasCredito>0&&(o.diasCredito=e.diasCredito),(this.esEdicion?this.svc.actualizar(this.data.cliente.id,o):this.svc.crear(o)).subscribe({next:()=>{this.notify.exito(this.esEdicion?"Cliente actualizado":"Cliente creado"),this.dialogRef.close(!0)},error:()=>{this.guardando.set(!1),this.notify.error("Error al guardar cliente")}})}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275cmp=D({type:t,selectors:[["app-cliente-form-dialog"]],standalone:!0,features:[T],decls:52,vars:10,consts:[["mat-dialog-title",""],[1,"flex","flex-col","gap-4"],["id","clienteForm",1,"flex","flex-col","gap-4","pt-2",3,"ngSubmit","formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","nombre","placeholder","Nombre del cliente"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-4"],["appearance","outline"],["matInput","","formControlName","telefono","placeholder","(555) 123-4567"],["matInput","","formControlName","correo","placeholder","correo@ejemplo.com","type","email"],["matInput","","formControlName","direccion","placeholder","Direcci\xF3n del cliente","rows","2"],["matInput","","formControlName","rfc","placeholder","XAXX010101000","maxlength","13"],["matPrefix",""],["matInput","","type","number","formControlName","limiteCredito","min","0","step","100"],["matInput","","type","number","formControlName","diasCredito","min","0"],["matInput","","formControlName","notas","placeholder","Notas adicionales","rows","3"],["align","end"],["mat-button","","mat-dialog-close","",3,"disabled"],["mat-flat-button","","color","primary","type","submit","form","clienteForm",3,"disabled"],["diameter","20",1,"inline-block","mr-2"]],template:function(o,l){o&1&&(n(0,"h2",0),a(1),i(),n(2,"mat-dialog-content",1)(3,"form",2),f("ngSubmit",function(){return l.guardar()}),n(4,"mat-form-field",3)(5,"mat-label"),a(6,"Nombre"),i(),c(7,"input",4),s(8,Ue,2,0,"mat-error")(9,Je,2,0,"mat-error"),i(),n(10,"div",5)(11,"mat-form-field",6)(12,"mat-label"),a(13,"Tel\xE9fono"),i(),c(14,"input",7),i(),n(15,"mat-form-field",6)(16,"mat-label"),a(17,"Correo"),i(),c(18,"input",8),s(19,Ke,2,0,"mat-error"),i()(),n(20,"mat-form-field",3)(21,"mat-label"),a(22,"Direcci\xF3n"),i(),c(23,"textarea",9),i(),n(24,"mat-form-field",3)(25,"mat-label"),a(26,"RFC"),i(),c(27,"input",10),s(28,Qe,2,0,"mat-error"),i(),n(29,"div",5)(30,"mat-form-field",6)(31,"mat-label"),a(32,"L\xEDmite de cr\xE9dito"),i(),n(33,"span",11),a(34,"$\xA0"),i(),c(35,"input",12),i(),n(36,"mat-form-field",6)(37,"mat-label"),a(38,"D\xEDas de cr\xE9dito"),i(),c(39,"input",13),n(40,"mat-hint"),a(41,"0 = sin cr\xE9dito"),i()()(),n(42,"mat-form-field",3)(43,"mat-label"),a(44,"Notas"),i(),c(45,"textarea",14),i()()(),n(46,"mat-dialog-actions",15)(47,"button",16),a(48,"Cancelar"),i(),n(49,"button",17),s(50,We,1,0,"mat-spinner",18),a(51),i()()),o&2&&(m(),S("",l.esEdicion?"Editar":"Nuevo"," cliente"),m(2),p("formGroup",l.form),m(5),_(8,l.form.controls.nombre.hasError("required")?8:-1),m(),_(9,l.form.controls.nombre.hasError("minlength")?9:-1),m(10),_(19,l.form.controls.correo.hasError("email")?19:-1),m(9),_(28,l.form.controls.rfc.hasError("maxlength")?28:-1),m(19),p("disabled",l.guardando()),m(2),p("disabled",l.guardando()),m(),_(50,l.guardando()?50:-1),m(),S(" ",l.esEdicion?"Actualizar":"Crear"," "))},dependencies:[w,ie,K,X,Q,U,J,ee,Z,W,Y,A,Ve,Re,Ae,ke,me,le,ne,ae,oe,re,se,ce,N,F,P,R,V],styles:["[_nghost-%COMP%]{display:block}"]})}}return t})();var Ye=()=>[10,20,50];function Ze(t,r){t&1&&(n(0,"div",7),c(1,"mat-spinner",8),i())}function et(t,r){if(t&1){let e=y();n(0,"app-empty-state",9),f("accion",function(){v(e);let l=x();return M(l.crear())}),i()}}function tt(t,r){t&1&&(n(0,"th",28),a(1,"Nombre"),i())}function it(t,r){if(t&1&&(n(0,"td",29),a(1),i()),t&2){let e=r.$implicit;m(),E(e.nombre)}}function nt(t,r){t&1&&(n(0,"th",28),a(1,"Tel\xE9fono"),i())}function ot(t,r){if(t&1&&(n(0,"td",30),a(1),i()),t&2){let e=r.$implicit;m(),E(e.telefono||"\u2014")}}function at(t,r){t&1&&(n(0,"th",28),a(1,"Correo"),i())}function rt(t,r){if(t&1&&(n(0,"td",30),a(1),i()),t&2){let e=r.$implicit;m(),E(e.correo||"\u2014")}}function lt(t,r){t&1&&(n(0,"th",31),a(1,"Cr\xE9dito disponible"),i())}function mt(t,r){if(t&1&&(n(0,"td",32),a(1),q(2,"moneda"),i()),t&2){let e=r.$implicit,o=x(2);m(),E(G(2,1,o.creditoDisponible(e)))}}function ct(t,r){t&1&&(n(0,"th",31),a(1,"\xD3rdenes"),i())}function st(t,r){if(t&1&&(n(0,"td",32),a(1),i()),t&2){let e,o=r.$implicit;m(),E((e=o._count==null?null:o._count.ordenes)!==null&&e!==void 0?e:0)}}function dt(t,r){t&1&&(n(0,"th",28),a(1,"Estado"),i())}function pt(t,r){if(t&1&&(n(0,"td",30),c(1,"app-estado-badge",33),i()),t&2){let e=r.$implicit;m(),p("estado",e.activo?"activo":"inactivo")}}function ut(t,r){t&1&&c(0,"th",34)}function ft(t,r){if(t&1){let e=y();n(0,"td",30)(1,"button",35)(2,"mat-icon"),a(3,"more_vert"),i()(),n(4,"mat-menu",null,0)(6,"button",36),f("click",function(){let l=v(e).$implicit,u=x(2);return M(u.editar(l))}),n(7,"mat-icon"),a(8,"edit"),i(),a(9," Editar "),i(),n(10,"button",36),f("click",function(){let l=v(e).$implicit,u=x(2);return M(u.toggleActivo(l))}),n(11,"mat-icon"),a(12),i(),a(13),i(),n(14,"button",37),f("click",function(){let l=v(e).$implicit,u=x(2);return M(u.eliminar(l))}),n(15,"mat-icon",38),a(16,"delete"),i(),a(17," Eliminar "),i()()()}if(t&2){let e=r.$implicit,o=B(5);m(),p("matMenuTriggerFor",o),m(11),E(e.activo?"block":"check_circle"),m(),S(" ",e.activo?"Desactivar":"Activar"," ")}}function Ct(t,r){t&1&&c(0,"tr",39)}function _t(t,r){t&1&&c(0,"tr",40)}function ht(t,r){if(t&1){let e=y();n(0,"div",10)(1,"table",11),h(2,12),s(3,tt,2,0,"th",13)(4,it,2,1,"td",14),g(),h(5,15),s(6,nt,2,0,"th",13)(7,ot,2,1,"td",16),g(),h(8,17),s(9,at,2,0,"th",13)(10,rt,2,1,"td",16),g(),h(11,18),s(12,lt,2,0,"th",19)(13,mt,3,3,"td",20),g(),h(14,21),s(15,ct,2,0,"th",19)(16,st,2,1,"td",20),g(),h(17,22),s(18,dt,2,0,"th",13)(19,pt,2,1,"td",16),g(),h(20,23),s(21,ut,1,0,"th",24)(22,ft,18,3,"td",16),g(),s(23,Ct,1,0,"tr",25)(24,_t,1,0,"tr",26),i()(),n(25,"mat-paginator",27),f("page",function(l){v(e);let u=x();return M(u.cambiarPagina(l))}),i()}if(t&2){let e=x();m(),p("dataSource",e.clientes()),m(22),p("matHeaderRowDef",e.columnas),m(),p("matRowDefColumns",e.columnas),m(),p("length",e.total())("pageIndex",e.pagina())("pageSize",e.porPagina())("pageSizeOptions",L(7,Ye))}}var si=(()=>{class t{constructor(){this.svc=d($),this.dialog=d(Pe),this.notify=d(k),this.destroyRef=d(j),this.columnas=["nombre","telefono","correo","credito","ordenes","activo","acciones"],this.clientes=C([]),this.total=C(0),this.cargando=C(!1),this.busqueda=C(""),this.pagina=C(0),this.porPagina=C(20)}ngOnInit(){this.cargar()}cargar(){this.cargando.set(!0);let e={pagina:this.pagina()+1,porPagina:this.porPagina()};this.busqueda()&&(e.buscar=this.busqueda()),this.svc.listar(e).pipe(I(this.destroyRef)).subscribe({next:o=>{this.clientes.set(o.datos),this.total.set(o.meta.total),this.cargando.set(!1)},error:()=>{this.cargando.set(!1),this.notify.error("Error al cargar clientes")}})}buscar(e){this.busqueda.set(e),this.pagina.set(0),this.cargar()}cambiarPagina(e){this.pagina.set(e.pageIndex),this.porPagina.set(e.pageSize),this.cargar()}crear(){this.dialog.open(z,{width:"600px",data:{modo:"crear"}}).afterClosed().subscribe(e=>e&&this.cargar())}editar(e){this.dialog.open(z,{width:"600px",data:{modo:"editar",cliente:e}}).afterClosed().subscribe(o=>o&&this.cargar())}eliminar(e){this.dialog.open(Be,{data:{titulo:"Eliminar cliente",mensaje:`\xBFEliminar "${e.nombre}"? Esta acci\xF3n no se puede deshacer.`,textoConfirmar:"Eliminar",color:"warn"}}).afterClosed().subscribe(o=>{o&&this.svc.eliminar(e.id).pipe(I(this.destroyRef)).subscribe({next:()=>{this.notify.exito("Cliente eliminado"),this.cargar()},error:()=>this.notify.error("Error al eliminar cliente")})})}toggleActivo(e){this.svc.actualizar(e.id,{activo:!e.activo}).pipe(I(this.destroyRef)).subscribe({next:()=>{this.notify.exito(e.activo?"Cliente desactivado":"Cliente activado"),this.cargar()},error:()=>this.notify.error("Error al actualizar cliente")})}creditoDisponible(e){return e.limiteCredito-e.creditoUtilizado}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275cmp=D({type:t,selectors:[["app-clientes"]],standalone:!0,features:[T],decls:12,vars:1,consts:[["menu","matMenu"],["titulo","Clientes","subtitulo","Gesti\xF3n de clientes y cr\xE9ditos","icono","people"],["mat-flat-button","","color","primary",3,"click"],[1,"page-container"],[1,"card"],[1,"card-header"],["placeholder","Buscar por nombre, tel\xE9fono...",3,"buscar"],[1,"flex","justify-center","py-10"],["diameter","40"],["icono","people_outline","mensaje","No se encontraron clientes","submensaje","Crea tu primer cliente para comenzar","textoAccion","Nuevo cliente",3,"accion"],[1,"overflow-x-auto"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","nombre"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","class","font-medium",4,"matCellDef"],["matColumnDef","telefono"],["mat-cell","",4,"matCellDef"],["matColumnDef","correo"],["matColumnDef","credito"],["mat-header-cell","","class","text-right",4,"matHeaderCellDef"],["mat-cell","","class","text-right",4,"matCellDef"],["matColumnDef","ordenes"],["matColumnDef","activo"],["matColumnDef","acciones"],["mat-header-cell","","class","w-16",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"page","length","pageIndex","pageSize","pageSizeOptions"],["mat-header-cell",""],["mat-cell","",1,"font-medium"],["mat-cell",""],["mat-header-cell","",1,"text-right"],["mat-cell","",1,"text-right"],["tipo","activo",3,"estado"],["mat-header-cell","",1,"w-16"],["mat-icon-button","",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","",1,"text-red-600",3,"click"],["color","warn"],["mat-header-row",""],["mat-row",""]],template:function(o,l){o&1&&(n(0,"app-page-header",1)(1,"button",2),f("click",function(){return l.crear()}),n(2,"mat-icon"),a(3,"add"),i(),a(4," Nuevo cliente "),i()(),n(5,"div",3)(6,"div",4)(7,"div",5)(8,"app-search-input",6),f("buscar",function(Ge){return l.buscar(Ge)}),i()(),s(9,Ze,2,0,"div",7)(10,et,1,0)(11,ht,26,8),i()()),o&2&&(m(9),_(9,l.cargando()?9:l.clientes().length===0?10:11))},dependencies:[w,Te,he,xe,Me,be,ge,Se,Ee,ve,De,ye,Ie,we,N,F,de,P,pe,_e,fe,ue,Ce,A,R,V,$e,ze,He,je,Le],styles:["[_nghost-%COMP%]{display:block}"]})}}return t})();export{si as ClientesComponent};
