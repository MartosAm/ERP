import{a as V}from"./chunk-KX2HKXA4.js";import{b as je}from"./chunk-JOJDWOBY.js";import{A as $e,B as Be,a as pe,b as ue,c as fe,d as ge,e as _e,f as Ce,g as he,h as xe,i as be,j as Ee,k as Me,l as Se,m as ve,n as De,o as ye,p as Ie,q as Te,r as we,s as Fe,t as ke,u as Ne,v as Re,w as He,x as Pe,y as Ve,z as Ae}from"./chunk-DYVYMDZ3.js";import{a as te,b as ie,h as oe,i as ae,j as ne,k as re}from"./chunk-WGOZBQ6C.js";import{a as le,b as ce,c as se,d as de}from"./chunk-OPDHGN22.js";import{b as q,d as T,f as U,g as J,j as K,k as Q,m as W,n as X,r as Y,s as Z}from"./chunk-25KKNSP5.js";import{a as R,b as H}from"./chunk-GZNJA4L5.js";import{a as E,c as k,d as N}from"./chunk-TIT22AFP.js";import{$ as F,T as ee,Z as w,_ as me,xa as P}from"./chunk-BAV5PXE6.js";import{p as I}from"./chunk-C42ID75Y.js";import{$a as l,Bb as z,Cb as O,Db as o,Eb as i,Fa as B,Fb as s,Gb as h,Hb as x,Jb as D,Ob as f,Qb as _,Xb as G,Yb as a,Zb as b,_b as A,bc as y,cc as L,ia as d,mb as C,na as v,sb as c,ub as p,vb as j,xa as M,ya as S,zb as u}from"./chunk-HI7W2E7R.js";var Ue=(t,n)=>n.id;function Je(t,n){t&1&&(o(0,"mat-error"),a(1,"El nombre es obligatorio"),i())}function Ke(t,n){t&1&&(o(0,"mat-error"),a(1,"M\xEDnimo 2 caracteres"),i())}function Qe(t,n){if(t&1&&(o(0,"mat-option",9),a(1),i()),t&2){let e=n.$implicit;p("value",e.id),l(),b(e.nombre)}}function We(t,n){t&1&&s(0,"mat-spinner",17)}var $=(()=>{class t{constructor(){this.fb=d(Y),this.svc=d(V),this.notify=d(P),this.dialogRef=d(Ie),this.data=d(Te),this.guardando=C(!1),this.categoriasPadre=C([]),this.form=this.fb.nonNullable.group({nombre:["",[T.required,T.minLength(2),T.maxLength(100)]],descripcion:[""],padreId:[""],colorHex:[""],nombreIcono:[""],orden:[0]})}get esEdicion(){return this.data.modo==="editar"}ngOnInit(){if(this.svc.obtenerArbol().subscribe(e=>this.categoriasPadre.set(e)),this.esEdicion&&this.data.categoria){let e=this.data.categoria;this.form.patchValue({nombre:e.nombre,descripcion:e.descripcion??"",padreId:e.padreId??"",colorHex:e.colorHex??"",nombreIcono:e.nombreIcono??"",orden:e.orden})}}guardar(){if(this.form.invalid){this.form.markAllAsTouched();return}this.guardando.set(!0);let e=this.form.getRawValue(),m={nombre:e.nombre};e.descripcion&&(m.descripcion=e.descripcion),e.padreId&&(m.padreId=e.padreId),e.colorHex&&(m.colorHex=e.colorHex),e.nombreIcono&&(m.nombreIcono=e.nombreIcono),e.orden>0&&(m.orden=e.orden),(this.esEdicion?this.svc.actualizar(this.data.categoria.id,m):this.svc.crear(m)).subscribe({next:()=>{this.notify.exito(this.esEdicion?"Categor\xEDa actualizada":"Categor\xEDa creada"),this.dialogRef.close(!0)},error:()=>{this.guardando.set(!1),this.notify.error("Error al guardar categor\xEDa")}})}static{this.\u0275fac=function(m){return new(m||t)}}static{this.\u0275cmp=v({type:t,selectors:[["app-categoria-form-dialog"]],standalone:!0,features:[y],decls:43,vars:7,consts:[["mat-dialog-title","",1,"flex","items-center","gap-2"],[1,"text-primary"],[1,"flex","flex-col","gap-4","pt-2","min-w-[400px]"],[1,"flex","flex-col","gap-3",3,"formGroup"],["appearance","outline"],["matInput","","formControlName","nombre","placeholder","Ej: Materiales"],["matInput","","formControlName","descripcion","rows","2","placeholder","Descripci\xF3n opcional"],["formControlName","padreId"],["value",""],[3,"value"],[1,"grid","grid-cols-2","gap-3"],["matInput","","formControlName","colorHex","placeholder","#FF5733"],["matInput","","formControlName","nombreIcono","placeholder","category"],["matInput","","type","number","formControlName","orden"],["align","end",1,"gap-2"],["mat-button","","mat-dialog-close",""],["mat-raised-button","","color","primary",3,"click","disabled"],["diameter","20",1,"inline-block","mr-2"]],template:function(m,r){m&1&&(o(0,"h2",0)(1,"mat-icon",1),a(2,"category"),i(),a(3),i(),o(4,"mat-dialog-content",2)(5,"form",3)(6,"mat-form-field",4)(7,"mat-label"),a(8,"Nombre"),i(),s(9,"input",5),c(10,Je,2,0,"mat-error")(11,Ke,2,0,"mat-error"),i(),o(12,"mat-form-field",4)(13,"mat-label"),a(14,"Descripci\xF3n"),i(),s(15,"textarea",6),i(),o(16,"mat-form-field",4)(17,"mat-label"),a(18,"Categor\xEDa padre"),i(),o(19,"mat-select",7)(20,"mat-option",8),a(21,"Sin padre (ra\xEDz)"),i(),z(22,Qe,2,2,"mat-option",9,Ue),i()(),o(24,"div",10)(25,"mat-form-field",4)(26,"mat-label"),a(27,"Color (hex)"),i(),s(28,"input",11),i(),o(29,"mat-form-field",4)(30,"mat-label"),a(31,"Icono"),i(),s(32,"input",12),i()(),o(33,"mat-form-field",4)(34,"mat-label"),a(35,"Orden"),i(),s(36,"input",13),i()()(),o(37,"mat-dialog-actions",14)(38,"button",15),a(39,"Cancelar"),i(),o(40,"button",16),f("click",function(){return r.guardar()}),c(41,We,1,0,"mat-spinner",17),a(42),i()()),m&2&&(l(3),A(" ",r.esEdicion?"Editar":"Nueva",` categor\xEDa
`),l(2),p("formGroup",r.form),l(5),u(10,r.form.controls.nombre.hasError("required")?10:-1),l(),u(11,r.form.controls.nombre.hasError("minlength")?11:-1),l(11),O(r.categoriasPadre()),l(18),p("disabled",r.guardando()),l(),u(41,r.guardando()?41:-1),l(),A(" ",r.esEdicion?"Actualizar":"Crear"," "))},dependencies:[I,Z,K,q,Q,U,J,W,X,He,Fe,ke,Re,Ne,ae,oe,te,ie,re,ne,ve,Se,ee,F,w,N,k,je,H,R],styles:["[_nghost-%COMP%]{display:block}"]})}}return t})();var Xe=()=>[10,20,50];function Ye(t,n){t&1&&(o(0,"div",6),s(1,"mat-spinner",7),i())}function Ze(t,n){t&1&&(o(0,"th",25),a(1,"Nombre"),i())}function et(t,n){if(t&1&&s(0,"span",30),t&2){let e=_().$implicit;j("background",e.colorHex)}}function tt(t,n){if(t&1&&(o(0,"td",26)(1,"div",27),c(2,et,1,2,"span",28),o(3,"span",29),a(4),i()()()),t&2){let e=n.$implicit;l(2),u(2,e.colorHex?2:-1),l(2),b(e.nombre)}}function it(t,n){t&1&&(o(0,"th",25),a(1,"Padre"),i())}function ot(t,n){if(t&1&&(o(0,"td",26),a(1),i()),t&2){let e=n.$implicit;l(),b((e.padre==null?null:e.padre.nombre)||"\u2014")}}function at(t,n){t&1&&(o(0,"th",31),a(1,"Productos"),i())}function nt(t,n){if(t&1&&(o(0,"td",32),a(1),i()),t&2){let e=n.$implicit;l(),b(e._count.productos)}}function rt(t,n){t&1&&(o(0,"th",31),a(1,"Subcategor\xEDas"),i())}function mt(t,n){if(t&1&&(o(0,"td",32),a(1),i()),t&2){let e=n.$implicit;l(),b(e._count.hijos)}}function lt(t,n){t&1&&(o(0,"th",25),a(1,"Estado"),i())}function ct(t,n){if(t&1&&(o(0,"td",26),s(1,"app-estado-badge",33),i()),t&2){let e=n.$implicit;l(),p("estado",e.activo)}}function st(t,n){t&1&&s(0,"th",34)}function dt(t,n){if(t&1){let e=D();o(0,"td",26)(1,"button",35)(2,"mat-icon"),a(3,"more_vert"),i()(),o(4,"mat-menu",null,0)(6,"button",36),f("click",function(){let r=M(e).$implicit,g=_(2);return S(g.editar(r))}),o(7,"mat-icon"),a(8,"edit"),i(),a(9," Editar "),i(),o(10,"button",37),f("click",function(){let r=M(e).$implicit,g=_(2);return S(g.eliminar(r))}),o(11,"mat-icon",38),a(12,"delete"),i(),a(13," Eliminar "),i()()()}if(t&2){let e=G(5);l(),p("matMenuTriggerFor",e)}}function pt(t,n){t&1&&s(0,"tr",39)}function ut(t,n){t&1&&s(0,"tr",40)}function ft(t,n){if(t&1){let e=D();o(0,"app-empty-state",41),f("accion",function(){M(e);let r=_(2);return S(r.crear())}),i()}}function gt(t,n){if(t&1){let e=D();o(0,"mat-paginator",42),f("page",function(r){M(e);let g=_(2);return S(g.onPage(r))}),i()}if(t&2){let e=_(2);p("length",e.meta().total)("pageSize",e.meta().limite)("pageIndex",e.meta().pagina-1)("pageSizeOptions",L(4,Xe))}}function _t(t,n){if(t&1&&(o(0,"div",8)(1,"table",9),h(2,10),c(3,Ze,2,0,"th",11)(4,tt,5,2,"td",12),x(),h(5,13),c(6,it,2,0,"th",11)(7,ot,2,1,"td",12),x(),h(8,14),c(9,at,2,0,"th",15)(10,nt,2,1,"td",16),x(),h(11,17),c(12,rt,2,0,"th",15)(13,mt,2,1,"td",16),x(),h(14,18),c(15,lt,2,0,"th",11)(16,ct,2,1,"td",12),x(),h(17,19),c(18,st,1,0,"th",20)(19,dt,14,1,"td",12),x(),c(20,pt,1,0,"tr",21)(21,ut,1,0,"tr",22),i(),c(22,ft,1,0,"app-empty-state",23)(23,gt,1,5,"mat-paginator",24),i()),t&2){let e=_();l(),p("dataSource",e.items()),l(19),p("matHeaderRowDef",e.columnas),l(),p("matRowDefColumns",e.columnas),l(),u(22,e.items().length===0?22:-1),l(),u(23,e.meta()?23:-1)}}var ri=(()=>{class t{constructor(){this.svc=d(V),this.dialog=d(we),this.notify=d(P),this.destroyRef=d(B),this.items=C([]),this.meta=C(null),this.cargando=C(!1),this.columnas=["nombre","padre","productos","hijos","activo","acciones"],this.buscar="",this.pagina=1,this.limite=20}ngOnInit(){this.cargar()}cargar(){this.cargando.set(!0),this.svc.listar({pagina:this.pagina,limite:this.limite,buscar:this.buscar}).pipe(E(this.destroyRef)).subscribe({next:e=>{this.items.set(e.datos),this.meta.set(e.meta),this.cargando.set(!1)},error:()=>this.cargando.set(!1)})}onBuscar(e){this.buscar=e,this.pagina=1,this.cargar()}onPage(e){this.pagina=e.pageIndex+1,this.limite=e.pageSize,this.cargar()}crear(){this.dialog.open($,{width:"500px",disableClose:!0,data:{modo:"crear"}}).afterClosed().pipe(E(this.destroyRef)).subscribe(m=>{m&&this.cargar()})}editar(e){this.dialog.open($,{width:"500px",disableClose:!0,data:{modo:"editar",categoria:e}}).afterClosed().pipe(E(this.destroyRef)).subscribe(r=>{r&&this.cargar()})}eliminar(e){this.dialog.open(Be,{data:{titulo:"Eliminar categor\xEDa",mensaje:`\xBFEst\xE1s seguro de eliminar "${e.nombre}"? Se desactivar\xE1 junto con sus subcategor\xEDas.`}}).afterClosed().pipe(E(this.destroyRef)).subscribe(r=>{r&&this.svc.eliminar(e.id).pipe(E(this.destroyRef)).subscribe({next:()=>{this.notify.exito("Categor\xEDa eliminada"),this.cargar()},error:()=>this.notify.error("Error al eliminar categor\xEDa")})})}static{this.\u0275fac=function(m){return new(m||t)}}static{this.\u0275cmp=v({type:t,selectors:[["app-categorias"]],standalone:!0,features:[y],decls:10,vars:1,consts:[["menu","matMenu"],[1,"page-container"],["titulo","Categor\xEDas","subtitulo","Gesti\xF3n del cat\xE1logo de categor\xEDas","icono","category"],["mat-raised-button","","color","primary",3,"click"],[1,"card","mb-4"],["placeholder","Buscar categor\xEDa...",3,"buscar"],[1,"flex","justify-center","py-10"],["diameter","40"],[1,"card","overflow-x-auto"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","nombre"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","padre"],["matColumnDef","productos"],["mat-header-cell","","class","text-center",4,"matHeaderCellDef"],["mat-cell","","class","text-center",4,"matCellDef"],["matColumnDef","hijos"],["matColumnDef","activo"],["matColumnDef","acciones"],["mat-header-cell","","class","w-16",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","hover:bg-gray-50",4,"matRowDef","matRowDefColumns"],["icono","category","mensaje","No se encontraron categor\xEDas","textoAccion","Crear categor\xEDa"],["showFirstLastButtons","",3,"length","pageSize","pageIndex","pageSizeOptions"],["mat-header-cell",""],["mat-cell",""],[1,"flex","items-center","gap-2"],[1,"w-3","h-3","rounded-full","inline-block",3,"background"],[1,"font-medium"],[1,"w-3","h-3","rounded-full","inline-block"],["mat-header-cell","",1,"text-center"],["mat-cell","",1,"text-center"],["tipo","activo",3,"estado"],["mat-header-cell","",1,"w-16"],["mat-icon-button","","aria-label","Acciones",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","",1,"!text-red-600",3,"click"],[1,"!text-red-600"],["mat-header-row",""],["mat-row","",1,"hover:bg-gray-50"],["icono","category","mensaje","No se encontraron categor\xEDas","textoAccion","Crear categor\xEDa",3,"accion"],["showFirstLastButtons","",3,"page","length","pageSize","pageIndex","pageSizeOptions"]],template:function(m,r){m&1&&(o(0,"div",1)(1,"app-page-header",2)(2,"button",3),f("click",function(){return r.crear()}),o(3,"mat-icon"),a(4,"add"),i(),a(5," Nueva categor\xEDa "),i()(),o(6,"div",4)(7,"app-search-input",5),f("buscar",function(ze){return r.onBuscar(ze)}),i()(),c(8,Ye,2,0,"div",6)(9,_t,24,5),i()),m&2&&(l(8),u(8,r.cargando()?8:9))},dependencies:[I,Me,pe,fe,he,ge,ue,xe,_e,Ce,be,Ee,ye,De,N,k,F,w,me,de,ce,le,se,H,R,Pe,Ve,Ae,$e],styles:["[_nghost-%COMP%]{display:block}"]})}}return t})();export{ri as CategoriasComponent};
