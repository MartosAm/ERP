import{a as k}from"./chunk-HL7ILI5W.js";import{A as Ne,B as Re,a as le,b as de,c as ce,d as se,e as pe,f as fe,g as ue,h as _e,i as Ce,j as he,k as ge,n as ve,o as xe,p as be,q as Ee,r as Me,s as Se,t as Pe,u as De,v as ye,w as Te,x as we,y as Fe,z as Ie}from"./chunk-DYVYMDZ3.js";import{a as Q,b as W,h as Y,i as Z,j as ee,k as te}from"./chunk-WGOZBQ6C.js";import{a as ne,b as re,c as ae,d as me}from"./chunk-OPDHGN22.js";import{b as L,d as b,f as j,g as O,j as G,m as X,n as q,q as U,r as J,s as K}from"./chunk-25KKNSP5.js";import{a as N,b as R}from"./chunk-GZNJA4L5.js";import{a as E,c as ie,d as I}from"./chunk-TIT22AFP.js";import{$ as F,Z as w,_ as oe,xa as V}from"./chunk-BAV5PXE6.js";import{p as T}from"./chunk-C42ID75Y.js";import{$a as l,Db as i,Eb as o,Fa as $,Fb as c,Gb as C,Hb as h,Jb as D,Ob as u,Qb as g,Xb as z,Yb as n,Zb as x,_b as A,bc as y,cc as H,ia as s,mb as v,na as P,sb as d,ub as p,xa as M,ya as S,zb as f}from"./chunk-HI7W2E7R.js";function $e(t,r){t&1&&(i(0,"mat-error"),n(1,"El nombre es obligatorio"),o())}function ze(t,r){t&1&&(i(0,"mat-error"),n(1,"M\xEDnimo 2 caracteres"),o())}function He(t,r){t&1&&(i(0,"mat-error"),n(1,"Correo inv\xE1lido"),o())}function Le(t,r){t&1&&(i(0,"mat-error"),n(1,"M\xE1ximo 13 caracteres"),o())}function je(t,r){t&1&&c(0,"mat-spinner",16)}var B=(()=>{class t{get esEdicion(){return this.data.modo==="editar"}constructor(){if(this.fb=s(J),this.svc=s(k),this.notify=s(V),this.dialogRef=s(be),this.data=s(Ee),this.guardando=v(!1),this.form=this.fb.nonNullable.group({nombre:["",[b.required,b.minLength(2),b.maxLength(150)]],nombreContacto:[""],telefono:[""],correo:["",[b.email]],direccion:[""],rfc:["",[b.maxLength(13)]],notas:[""]}),this.esEdicion&&this.data.proveedor){let e=this.data.proveedor;this.form.patchValue({nombre:e.nombre,nombreContacto:e.nombreContacto??"",telefono:e.telefono??"",correo:e.correo??"",direccion:e.direccion??"",rfc:e.rfc??""})}}guardar(){if(this.form.invalid){this.form.markAllAsTouched();return}this.guardando.set(!0);let e=this.form.getRawValue(),m={nombre:e.nombre};e.nombreContacto&&(m.nombreContacto=e.nombreContacto),e.telefono&&(m.telefono=e.telefono),e.correo&&(m.correo=e.correo),e.direccion&&(m.direccion=e.direccion),e.rfc&&(m.rfc=e.rfc),e.notas&&(m.notas=e.notas),(this.esEdicion?this.svc.actualizar(this.data.proveedor.id,m):this.svc.crear(m)).subscribe({next:()=>{this.notify.exito(this.esEdicion?"Proveedor actualizado":"Proveedor creado"),this.dialogRef.close(!0)},error:()=>{this.guardando.set(!1),this.notify.error("Error al guardar proveedor")}})}static{this.\u0275fac=function(m){return new(m||t)}}static{this.\u0275cmp=P({type:t,selectors:[["app-proveedor-form-dialog"]],standalone:!0,features:[y],decls:43,vars:10,consts:[["mat-dialog-title",""],[1,"flex","flex-col","gap-4"],["id","proveedorForm",1,"flex","flex-col","gap-4","pt-2",3,"ngSubmit","formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","nombre","placeholder","Nombre del proveedor"],["matInput","","formControlName","nombreContacto","placeholder","Persona de contacto"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-4"],["appearance","outline"],["matInput","","formControlName","telefono","placeholder","(555) 123-4567"],["matInput","","formControlName","correo","placeholder","correo@ejemplo.com","type","email"],["matInput","","formControlName","direccion","placeholder","Direcci\xF3n del proveedor","rows","2"],["matInput","","formControlName","rfc","placeholder","XAXX010101000","maxlength","13"],["matInput","","formControlName","notas","placeholder","Notas adicionales","rows","3"],["align","end"],["mat-button","","mat-dialog-close","",3,"disabled"],["mat-flat-button","","color","primary","type","submit","form","proveedorForm",3,"disabled"],["diameter","20",1,"inline-block","mr-2"]],template:function(m,a){m&1&&(i(0,"h2",0),n(1),o(),i(2,"mat-dialog-content",1)(3,"form",2),u("ngSubmit",function(){return a.guardar()}),i(4,"mat-form-field",3)(5,"mat-label"),n(6,"Nombre"),o(),c(7,"input",4),d(8,$e,2,0,"mat-error")(9,ze,2,0,"mat-error"),o(),i(10,"mat-form-field",3)(11,"mat-label"),n(12,"Nombre contacto"),o(),c(13,"input",5),o(),i(14,"div",6)(15,"mat-form-field",7)(16,"mat-label"),n(17,"Tel\xE9fono"),o(),c(18,"input",8),o(),i(19,"mat-form-field",7)(20,"mat-label"),n(21,"Correo"),o(),c(22,"input",9),d(23,He,2,0,"mat-error"),o()(),i(24,"mat-form-field",3)(25,"mat-label"),n(26,"Direcci\xF3n"),o(),c(27,"textarea",10),o(),i(28,"mat-form-field",3)(29,"mat-label"),n(30,"RFC"),o(),c(31,"input",11),d(32,Le,2,0,"mat-error"),o(),i(33,"mat-form-field",3)(34,"mat-label"),n(35,"Notas"),o(),c(36,"textarea",12),o()()(),i(37,"mat-dialog-actions",13)(38,"button",14),n(39,"Cancelar"),o(),i(40,"button",15),d(41,je,1,0,"mat-spinner",16),n(42),o()()),m&2&&(l(),A("",a.esEdicion?"Editar":"Nuevo"," proveedor"),l(2),p("formGroup",a.form),l(5),f(8,a.form.controls.nombre.hasError("required")?8:-1),l(),f(9,a.form.controls.nombre.hasError("minlength")?9:-1),l(14),f(23,a.form.controls.correo.hasError("email")?23:-1),l(9),f(32,a.form.controls.rfc.hasError("maxlength")?32:-1),l(6),p("disabled",a.guardando()),l(2),p("disabled",a.guardando()),l(),f(41,a.guardando()?41:-1),l(),A(" ",a.esEdicion?"Actualizar":"Crear"," "))},dependencies:[T,K,G,L,j,O,U,X,q,Te,Se,Pe,ye,De,Z,Y,Q,W,te,ee,F,w,I,R,N],styles:["[_nghost-%COMP%]{display:block}"]})}}return t})();var Oe=()=>[10,20,50];function Ge(t,r){t&1&&(i(0,"div",6),c(1,"mat-spinner",7),o())}function Xe(t,r){t&1&&(i(0,"th",27),n(1,"Nombre"),o())}function qe(t,r){if(t&1&&(i(0,"td",28),n(1),o()),t&2){let e=r.$implicit;l(),x(e.nombre)}}function Ue(t,r){t&1&&(i(0,"th",27),n(1,"Contacto"),o())}function Je(t,r){if(t&1&&(i(0,"td",29),n(1),o()),t&2){let e=r.$implicit;l(),x(e.nombreContacto||"\u2014")}}function Ke(t,r){t&1&&(i(0,"th",27),n(1,"Tel\xE9fono"),o())}function Qe(t,r){if(t&1&&(i(0,"td",29),n(1),o()),t&2){let e=r.$implicit;l(),x(e.telefono||"\u2014")}}function We(t,r){t&1&&(i(0,"th",27),n(1,"Correo"),o())}function Ye(t,r){if(t&1&&(i(0,"td",29),n(1),o()),t&2){let e=r.$implicit;l(),x(e.correo||"\u2014")}}function Ze(t,r){t&1&&(i(0,"th",30),n(1,"Productos"),o())}function et(t,r){if(t&1&&(i(0,"td",31),n(1),o()),t&2){let e=r.$implicit;l(),x(e._count.productos)}}function tt(t,r){t&1&&(i(0,"th",27),n(1,"Estado"),o())}function ot(t,r){if(t&1&&(i(0,"td",29),c(1,"app-estado-badge",32),o()),t&2){let e=r.$implicit;l(),p("estado",e.activo)}}function it(t,r){t&1&&c(0,"th",33)}function nt(t,r){if(t&1){let e=D();i(0,"td",29)(1,"button",34)(2,"mat-icon"),n(3,"more_vert"),o()(),i(4,"mat-menu",null,0)(6,"button",35),u("click",function(){let a=M(e).$implicit,_=g(2);return S(_.editar(a))}),i(7,"mat-icon"),n(8,"edit"),o(),n(9," Editar "),o(),i(10,"button",36),u("click",function(){let a=M(e).$implicit,_=g(2);return S(_.eliminar(a))}),i(11,"mat-icon",37),n(12,"delete"),o(),n(13," Eliminar "),o()()()}if(t&2){let e=z(5);l(),p("matMenuTriggerFor",e)}}function rt(t,r){t&1&&c(0,"tr",38)}function at(t,r){t&1&&c(0,"tr",39)}function mt(t,r){if(t&1){let e=D();i(0,"app-empty-state",40),u("accion",function(){M(e);let a=g(2);return S(a.crear())}),o()}}function lt(t,r){if(t&1){let e=D();i(0,"mat-paginator",41),u("page",function(a){M(e);let _=g(2);return S(_.onPage(a))}),o()}if(t&2){let e=g(2);p("length",e.meta().total)("pageSize",e.meta().limite)("pageIndex",e.meta().pagina-1)("pageSizeOptions",H(4,Oe))}}function dt(t,r){if(t&1&&(i(0,"div",8)(1,"table",9),C(2,10),d(3,Xe,2,0,"th",11)(4,qe,2,1,"td",12),h(),C(5,13),d(6,Ue,2,0,"th",11)(7,Je,2,1,"td",14),h(),C(8,15),d(9,Ke,2,0,"th",11)(10,Qe,2,1,"td",14),h(),C(11,16),d(12,We,2,0,"th",11)(13,Ye,2,1,"td",14),h(),C(14,17),d(15,Ze,2,0,"th",18)(16,et,2,1,"td",19),h(),C(17,20),d(18,tt,2,0,"th",11)(19,ot,2,1,"td",14),h(),C(20,21),d(21,it,1,0,"th",22)(22,nt,14,1,"td",14),h(),d(23,rt,1,0,"tr",23)(24,at,1,0,"tr",24),o(),d(25,mt,1,0,"app-empty-state",25)(26,lt,1,5,"mat-paginator",26),o()),t&2){let e=g();l(),p("dataSource",e.items()),l(22),p("matHeaderRowDef",e.columnas),l(),p("matRowDefColumns",e.columnas),l(),f(25,e.items().length===0?25:-1),l(),f(26,e.meta()?26:-1)}}var Qt=(()=>{class t{constructor(){this.svc=s(k),this.dialog=s(Me),this.notify=s(V),this.destroyRef=s($),this.items=v([]),this.meta=v(null),this.cargando=v(!1),this.columnas=["nombre","contacto","telefono","correo","productos","activo","acciones"],this.buscar="",this.pagina=1,this.limite=20}ngOnInit(){this.cargar()}cargar(){this.cargando.set(!0),this.svc.listar({pagina:this.pagina,limite:this.limite,buscar:this.buscar}).pipe(E(this.destroyRef)).subscribe({next:e=>{this.items.set(e.datos),this.meta.set(e.meta),this.cargando.set(!1)},error:()=>this.cargando.set(!1)})}onBuscar(e){this.buscar=e,this.pagina=1,this.cargar()}onPage(e){this.pagina=e.pageIndex+1,this.limite=e.pageSize,this.cargar()}crear(){this.dialog.open(B,{width:"600px",disableClose:!0,data:{modo:"crear"}}).afterClosed().pipe(E(this.destroyRef)).subscribe(m=>{m&&this.cargar()})}editar(e){this.dialog.open(B,{width:"600px",disableClose:!0,data:{modo:"editar",proveedor:e}}).afterClosed().pipe(E(this.destroyRef)).subscribe(a=>{a&&this.cargar()})}eliminar(e){this.dialog.open(Re,{data:{titulo:"Eliminar proveedor",mensaje:`\xBFEst\xE1s seguro de eliminar "${e.nombre}"?`}}).afterClosed().pipe(E(this.destroyRef)).subscribe(a=>{a&&this.svc.eliminar(e.id).pipe(E(this.destroyRef)).subscribe({next:()=>{this.notify.exito("Proveedor eliminado"),this.cargar()},error:()=>this.notify.error("Error al eliminar proveedor")})})}static{this.\u0275fac=function(m){return new(m||t)}}static{this.\u0275cmp=P({type:t,selectors:[["app-proveedores"]],standalone:!0,features:[y],decls:10,vars:1,consts:[["menu","matMenu"],[1,"page-container"],["titulo","Proveedores","subtitulo","Gesti\xF3n de proveedores","icono","local_shipping"],["mat-raised-button","","color","primary",3,"click"],[1,"card","mb-4"],["placeholder","Buscar proveedor...",3,"buscar"],[1,"flex","justify-center","py-10"],["diameter","40"],[1,"card","overflow-x-auto"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","nombre"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","class","font-medium",4,"matCellDef"],["matColumnDef","contacto"],["mat-cell","",4,"matCellDef"],["matColumnDef","telefono"],["matColumnDef","correo"],["matColumnDef","productos"],["mat-header-cell","","class","text-center",4,"matHeaderCellDef"],["mat-cell","","class","text-center",4,"matCellDef"],["matColumnDef","activo"],["matColumnDef","acciones"],["mat-header-cell","","class","w-16",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","hover:bg-gray-50",4,"matRowDef","matRowDefColumns"],["icono","local_shipping","mensaje","No se encontraron proveedores","textoAccion","Crear proveedor"],["showFirstLastButtons","",3,"length","pageSize","pageIndex","pageSizeOptions"],["mat-header-cell",""],["mat-cell","",1,"font-medium"],["mat-cell",""],["mat-header-cell","",1,"text-center"],["mat-cell","",1,"text-center"],["tipo","activo",3,"estado"],["mat-header-cell","",1,"w-16"],["mat-icon-button","","aria-label","Acciones",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","",1,"!text-red-600",3,"click"],[1,"!text-red-600"],["mat-header-row",""],["mat-row","",1,"hover:bg-gray-50"],["icono","local_shipping","mensaje","No se encontraron proveedores","textoAccion","Crear proveedor",3,"accion"],["showFirstLastButtons","",3,"page","length","pageSize","pageIndex","pageSizeOptions"]],template:function(m,a){m&1&&(i(0,"div",1)(1,"app-page-header",2)(2,"button",3),u("click",function(){return a.crear()}),i(3,"mat-icon"),n(4,"add"),o(),n(5," Nuevo proveedor "),o()(),i(6,"div",4)(7,"app-search-input",5),u("buscar",function(Ve){return a.onBuscar(Ve)}),o()(),d(8,Ge,2,0,"div",6)(9,dt,27,5),o()),m&2&&(l(8),f(8,a.cargando()?8:9))},dependencies:[T,ge,le,ce,ue,se,de,_e,pe,fe,Ce,he,xe,ve,I,ie,F,w,oe,me,re,ne,ae,R,N,we,Fe,Ie,Ne],styles:["[_nghost-%COMP%]{display:block}"]})}}return t})();export{Qt as ProveedoresComponent};
