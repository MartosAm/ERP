<div class="page-container">
  @if (cargando()) {
    <div class="flex justify-center py-16">
      <mat-spinner diameter="48" />
    </div>
  } @else if (turno(); as t) {
    <app-page-header
      titulo="Detalle de turno"
      [subtitulo]="t.cajaRegistradora.nombre"
      icono="point_of_sale">
      <button mat-button (click)="volver()">
        <mat-icon>arrow_back</mat-icon> Volver
      </button>
    </app-page-header>

    <!-- Info general -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
      <mat-card>
        <mat-card-content class="p-4">
          <p class="text-sm text-gray-500 mb-1">Estado</p>
          <app-estado-badge [estado]="!t.cerradaEn" tipo="turno" />
        </mat-card-content>
      </mat-card>

      <mat-card>
        <mat-card-content class="p-4">
          <p class="text-sm text-gray-500 mb-1">Caja</p>
          <p class="font-medium">{{ t.cajaRegistradora.nombre }}</p>
        </mat-card-content>
      </mat-card>

      <mat-card>
        <mat-card-content class="p-4">
          <p class="text-sm text-gray-500 mb-1">Cajero</p>
          <p class="font-medium">{{ t.usuario.nombre }}</p>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Montos y tiempos -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
      <mat-card>
        <mat-card-content class="p-4 text-center">
          <p class="text-sm text-gray-500">Apertura</p>
          <p class="text-lg font-semibold">{{ t.montoApertura | moneda }}</p>
          <p class="text-xs text-gray-400 mt-1">{{ t.abiertaEn | fechaHora }}</p>
        </mat-card-content>
      </mat-card>

      <mat-card>
        <mat-card-content class="p-4 text-center">
          <p class="text-sm text-gray-500">Esperado</p>
          <p class="text-lg font-semibold">
            {{ t.montoEsperado !== null ? (t.montoEsperado | moneda) : '—' }}
          </p>
        </mat-card-content>
      </mat-card>

      <mat-card>
        <mat-card-content class="p-4 text-center">
          <p class="text-sm text-gray-500">Cierre</p>
          <p class="text-lg font-semibold">
            {{ t.montoCierre !== null ? (t.montoCierre | moneda) : '—' }}
          </p>
          @if (t.cerradaEn) {
            <p class="text-xs text-gray-400 mt-1">{{ t.cerradaEn | fechaHora }}</p>
          }
        </mat-card-content>
      </mat-card>

      <mat-card>
        <mat-card-content class="p-4 text-center">
          <p class="text-sm text-gray-500">Diferencia</p>
          @if (t.diferencia !== null) {
            <p class="text-2xl font-bold" [class]="diferenciaClass">
              {{ t.diferencia >= 0 ? '+' : '' }}{{ t.diferencia | moneda }}
            </p>
            <p class="text-xs mt-1" [class]="diferenciaClass">{{ diferenciaLabel }}</p>
          } @else {
            <p class="text-lg text-gray-400">—</p>
          }
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Resumen -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <mat-card>
        <mat-card-content class="p-4">
          <h3 class="text-sm font-semibold text-gray-700 mb-2">Información</h3>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-gray-500">Órdenes procesadas</span>
              <span class="font-medium">{{ t._count?.ordenes ?? '—' }}</span>
            </div>
            <mat-divider />
            <div class="flex justify-between">
              <span class="text-gray-500">Turno abierto</span>
              <span class="font-medium">{{ t.abiertaEn | fechaHora }}</span>
            </div>
            @if (t.cerradaEn) {
              <div class="flex justify-between">
                <span class="text-gray-500">Turno cerrado</span>
                <span class="font-medium">{{ t.cerradaEn | fechaHora }}</span>
              </div>
            }
          </div>
        </mat-card-content>
      </mat-card>

      @if (t.notas) {
        <mat-card>
          <mat-card-content class="p-4">
            <h3 class="text-sm font-semibold text-gray-700 mb-2">Notas</h3>
            <p class="text-sm whitespace-pre-line">{{ t.notas }}</p>
          </mat-card-content>
        </mat-card>
      }
    </div>
  }
</div>
